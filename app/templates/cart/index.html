{% extends "base.html" %}
{% block title %}Carrito{% endblock %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">Carrito</h1>

{% if items and items|length > 0 %}
  <div class="overflow-x-auto">
    <table class="w-full text-left border-separate" style="border-spacing: 0 .5rem">
      <thead>
        <tr class="text-gray-600">
          <th class="px-3 py-2">Producto</th>
          <th class="px-3 py-2">Precio</th>
          <th class="px-3 py-2">Cantidad</th>
          <th class="px-3 py-2">Subtotal</th>
          <th class="px-3 py-2 text-right">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
          <tr class="bg-gray-50">
            <td class="px-3 py-3 font-medium">{{ it.product.name }}</td>
            <td class="px-3 py-3">${{ "%.2f"|format(it.product.price) }}</td>
            <td class="px-3 py-3">
              <form class="flex items-center gap-2" method="post" action="{{ url_for('cart.update_cart', product_id=it.product.id) }}">
                <input name="quantity" type="number" min="1" max="{{ it.product.stock }}" value="{{ it.quantity }}"
                       class="w-20 px-2 py-1 border rounded focus:outline-none focus:ring" />
                <button class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Actualizar</button>
              </form>
              <div class="text-xs text-gray-500 mt-1">
                Stock: {{ it.product.stock }}
              </div>
            </td>
            <td class="px-3 py-3 font-semibold">
              ${{ "%.2f"|format(it.product.price * it.quantity) }}
            </td>
            <td class="px-3 py-3 text-right">
              <form method="post" action="{{ url_for('cart.remove_from_cart', product_id=it.product.id) }}">
                <button class="px-3 py-1 border rounded hover:bg-gray-100">Quitar</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <form method="post" action="{{ url_for('cart.empty_cart') }}">
        <button class="px-4 py-2 border rounded hover:bg-gray-100">Vaciar carrito</button>
      </form>
    </div>

    <div class="bg-white rounded shadow p-4">
      <h2 class="text-lg font-semibold mb-3">Resumen</h2>
      <div class="flex justify-between text-sm mb-1">
        <span>Subtotal</span>
        <span>${{ "%.2f"|format(totals.subtotal) }}</span>
      </div>
      <div class="flex justify-between text-sm mb-1">
        <span>Envío</span>
        <span>${{ "%.2f"|format(totals.shipping) }}</span>
      </div>
      <div class="flex justify-between text-sm mb-3">
        <span>Impuestos</span>
        <span>${{ "%.2f"|format(totals.taxes) }}</span>
      </div>
      <div class="flex justify-between text-base font-bold">
        <span>Total</span>
        <span>${{ "%.2f"|format(totals.total) }}</span>
      </div>

      <form method="post" action="{{ url_for('cart.checkout') }}" class="mt-4">
        <button class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
          Ir a pagar
        </button>
      </form>
      <p class="text-xs text-gray-500 mt-2">
        * Acciones simuladas (mock) — no se persisten cambios.
      </p>
    </div>
  </div>
{% else %}
  <p class="text-gray-600">Tu carrito está vacío.</p>
  <a href="{{ url_for('product.index') }}" class="text-blue-600 hover:underline">← Ver productos</a>
{% endif %}
{% endblock %}
